/*
 * Copyright (C) 2015 OpenPandora - http://www.pyra-handheld.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

/* overwrite device model */

/ {
	model = "Pyra-Handheld";

	aliases {
		display0 = &lcd;
		display1 = &hdmi0;
	};

	/* DC/DC converter for LCD panel */
/* disabled because the r63311 driver can control it */
/*	dsi1_panel_power: dsi1_panel_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "dsi1_panel_power";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio6 16 0>;	/ * gpio6_176 = display-enable/panel-reset * /
		startup-delay-us = <70000>;
		enable-active-high;
	}; */

	/* DC/DC converter for USB Host ports, Modem USB and HDMI 5V */
	modem_vbus_hdmi_power: tps2505_reg {
		compatible = "regulator-fixed";
		regulator-name = "modem_vbus_hdmi_power";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio99 8 GPIO_ACTIVE_HIGH>;
		enable-active-high;
		startup-delay-us = <70000>;
//		vin-supply = <&vsys_reg>;
		regulator-always-on;
	};

	/* this are the DC/DC converters that supply the
	   5V to USB devices connected to the Host ports.
	   They should be under the (software) control
	   of the USB3503A hub on the CPU board */

	host1_vbus_power:host1_vbus_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "host1_vbus_power";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio99 9 GPIO_ACTIVE_HIGH>;
		enable-active-high;
		startup-delay-us = <70000>;
		vin-supply = <&modem_vbus_hdmi_power>;
		regulator-always-on;
	};

	host2_vbus_power: host2_vbus_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "host2_vbus_power";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio99 10 GPIO_ACTIVE_HIGH>;
		enable-active-high;
		startup-delay-us = <70000>;
		vin-supply = <&modem_vbus_hdmi_power>;
		regulator-always-on;
	};

	/* this is the modem power switch (similar to a LDO) */
	modem_power: modem_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "modem_vbus_power";
		regulator-min-microvolt = <3700000>;
		regulator-max-microvolt = <3700000>;
		gpio = <&gpio99 15 GPIO_ACTIVE_HIGH>;
		enable-active-high;
		startup-delay-us = <100000>;
		/* the real input is vsys but it makes no sense
		   to power the modem without requesting vbus */
		vin-supply = <&modem_vbus_hdmi_power>;
		regulator-always-on;
	};

	modem_en: modem { /* control modem power through rfkill */
		compatible = "gemalto,phs8";
		gpio-controller;
		#gpio-cells = <2>;
		NIMP-usb-port = <&hsusb2_phy>; 	/* USB phy where we can check the modem status */
		on-off-gpio = <&gpio6 11 GPIO_ACTIVE_HIGH>;	/* gpio6_171: trigger to power on modem */
		on-indicator-gpio = <&gpio6 12 GPIO_ACTIVE_HIGH>;	/* gpio6_172: modem power indication feedback GPIO */
		NIMP-modem-supply = <&modem_power>;		/* enable some external power regulator */
		/* VBUS supply should probably be controlled through the USB PHY driver for the modem port */
		NIMP-vbus-supply = <&modem_vbus_hdmi_power>;	/* apply VBUS to the modem */
	};

/*	mic_presence {
/* FIXME: a dedicated TS3A225 driver can reprogram the MIC_PRESENT line through I2C into an INT so we can detect other changes (e.g. mic button pressed) * /
		compatible = "extcon-gpio";
		label = "mic_presence";
		interrupt-parent = <&gpio99>;
		interrupts = <14 IRQ_TYPE_EDGE_BOTH>;
		irq-flags = <IRQ_TYPE_EDGE_BOTH>;
		gpios = <&gpio99 14 GPIO_ACTIVE_LOW>;
		// debounce-delay-ms = <10>; -- not available at tca6424
		state-on = "present";
		state-off = "unplugged";
	}; */

	backlight {
		compatible = "pwm-backlight";
		pwms = <&pwm 0 2000000>;
		pwm-names = "backlight";
		brightness-levels = <0 11 20 30 40 50 60 70 80 90 100>;
		default-brightness-level = <9>;	/* => 90 */
//		pinctrl-names = "default";
//		pinctrl-0 = <&backlight_pins>;
//		power-supply = <&vdd_bl_reg>;
		enable-gpios = <&gpio6 30 0>;	/* GPT9/PWM gpio6_190 */
	};

	pwm: omap_pwm {
		compatible = "ti,omap-pwm";
		timers = <&timer9>;
		#pwm-cells = <2>;
	};

	keyboard-backlight {
/*
		compatible = "pwm-backlight";
		pwms = <&pwm 0 2000000>;
		pwm-names = "backlight";
		brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
		default-brightness-level = <9>;
//		pinctrl-names = "default";
//		pinctrl-0 = <&backlight_pins>;
//		power-supply = <&vdd_bl_reg>;
/*		enable-gpios = <&gpio6 30 0>;	/* GPT9/PWM gpio6_190 */
	};

};

/* LCD panel - MIPI */

&mipi_display_pins {
	pinctrl-single,pins = <
		OMAP5_IOPAD(0x124, PIN_OUTPUT_PULLUP | MUX_MODE6)	/* 0x124:[0:15] gpio6_162 - enable panel DC/DC */
		OMAP5_IOPAD(0x0ca, PIN_INPUT_PULLDOWN | MUX_MODE7)	/* 0x0C8:[31:16] gpio6_189 - VSYNC input */
		OMAP5_IOPAD(0x0f6, PIN_OUTPUT_PULLDOWN | MUX_MODE6)	/* 0x0F4:[31:16] gpio6_190 - choose MUX_MODE0 for PWM_TIMER9 - choose MUX_MODE7 if panel outputs the PWM */
		OMAP5_IOPAD(0x10e, PIN_OUTPUT_PULLDOWN | MUX_MODE6)	/* 0x10c:[31:16] gpio6_176 - panel reset */
		>;
};

&lcd {
	/* default to be overwritten by specific panel in derived board file
	   by using the /root/panelselect script */

	compatible = "mipi,debug";

	gpios =
		<&gpio6 16 0>,	/* goip6_176 = panel reset */
		<&gpio6 2 0>;	/* gpio6_162 = enable DC/DC */
};

/* add overlay pimmux for pyra on 5432evm */

&omap5_pmx_core {

	pinctrl-0 = <
			/* copied from original */
			&usbhost_pins
			&led_gpio_pins

			/* new entries */
			&pyra_button_pins
			&pyra_other_pins
	>;

/* this is for DragonFly V4 with the letux Cortex15 CPU board
// inputs
#define GPIO_LID 6			// lid close sensor - gpio1_wk6 - open collector output
#define GPIO_3G_PWR 172			// modem power indication - gpio6_172
#define GPIO_WAKEUP 15			// wakeup from modem - gpio1_wk15
#define GPIO_PENIRQ 173			// touch screen controller IRQ - gpio6_173
#define GPIO_LNUB_IRQ 175		// left nub IRQ - gpio6_175
#define GPIO_RNUB_IRQ 174		// right nub IRQ - gpio6_174
#define GPIO_KEYIRQ 177			// keyboard controller IRQ - gpio6-177
#define GPIO_RSH_BOT 179		// right bottom shoulder button - gpio6-179 - closes to GND
#define GPIO_RSH_TOP 180		// right top shoulder button - gpio6-180 - closes to GND
#define GPIO_RNUB 181			// right nub center button - gpio6-181 - closes to GND
#define GPIO_LNUB 187			// left nub center button - gpio6-187 - closes to GND
#define GPIO_LSH_BOT 183		// left bottom shoulder button - gpio6-183 - closes to GND
#define GPIO_LSH_TOP 184		// left top shoulder button - gpio6-184 - closes to GND
#define GPIO_VSYNC 189			// VSYNC input (gpio6_189 in: comes from panel)
// outputs
#define GPIO_3G_IGNITE 171		// start modem (active high pulse) - gpio6_171
#define GPIO_DISPEN 162			// enable TPS65133 or ssd2858 - gpio6_162
#define GPIO_DISPLAY_RESET 176		// panel reset (active low)/enable - gpio6_176
#define GPIO_PWM 190			// enable 18V backlight (active high) - timer9/gpio6_190 (out) - or input to track what the panel is doing
#define GPIO_PERIPHERAL_RESET 144	// device reset (active low)/enable - gpio5_144
*/

/* to find pinmux register offsets, see section A.7.2 in TRM

   note: offsets in the table are relative to 0x4a00 2800
   but reg = <0x4a002840 0x01b6> for omap5_pmx_core

   Therefore gpio5_153 with Address Offset 0x1D4
   translates into 0x194 (0xd0-0x40 => 0x90)
   and because it has [31:16] we have to add 0x02
   giving a result of 0x196.

   Definitions for bit patterns:
   0x0007	MUX_MODE0 .. MUX_MODE7
   0x0008	enable pull up/down
   0x0010	select pull up
   0x0020	disable power for I/O cell
   0x0100	enable input buffer (there is no explicit "enable output buffer" because that is defined by the GPIO direction)
   0x4000	enable wakeup detection

   or use the OMAP5_IOPAD() macros to do the conversion. You still have to look
   up the pin and register address offset in the TRM.
*/

	pyra_button_pins: pinmux_button_gpio_pins {
		pinctrl-single,pins = <
			OMAP5_IOPAD(0x044, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x044:[15:0] gpio1_wk6 - lid */
			OMAP5_IOPAD(0x1bc, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x1BC:[15:0] gpio5_140 - U */
			OMAP5_IOPAD(0x1be, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x1BC:[31:16] gpio5_141 - L */
			OMAP5_IOPAD(0x1c0, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x1C0:[15:0] gpio5_142 - D */
			OMAP5_IOPAD(0x1c2, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x1C0:[31:16] gpio5_143 - R */
			OMAP5_IOPAD(0x108, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x108:[15:0]  gpio6_179 - rsh-bot */
			OMAP5_IOPAD(0x106, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x104:[31:16] gpio6_180 - rsh-top */
			OMAP5_IOPAD(0x104, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x104:[15:0]  gpio6_181 - right nub */
			OMAP5_IOPAD(0x132, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x130:[31:16] gpio6_183 - lsh-bot */
			OMAP5_IOPAD(0x134, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x134:[15:0]  gpio6_184 - lsh-top */
			OMAP5_IOPAD(0x13a, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x138:[31:16]  gpio6_187 - left nub */
			OMAP5_IOPAD(0x102, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x100:[31:16] gpio7_196 - B */
			OMAP5_IOPAD(0x0fc, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x0FC:[15:0] gpio7_197 - Y */
			OMAP5_IOPAD(0x0fe, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x0FC:[31:16] gpio7_198 - X */
			OMAP5_IOPAD(0x100, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x100:[15:0] gpio7_199 - A */
		>;
	};

	pyra_other_pins: pinmux_other_gpio_pins {
		pinctrl-single,pins = <
			OMAP5_IOPAD(0x040, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x040:[15:0] gpio1_wk14 - wlan irq */
			OMAP5_IOPAD(0x042, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x040:[31:16] gpio1_wk15 - modem wakeup */
			OMAP5_IOPAD(0x0aa, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x0A8:[31:16] gpio3_77 - mmc3-cd */
			OMAP5_IOPAD(0x0ae, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x0AC:[31:16] gpio3_79 - mmc3-wp */
/* gpio 3_84-87 = BT HCI uart2 */
/* gpio 4_97-100 = GSM PCM mcbsp3 */
/* gpio 4_101-104 = BT PCM mcbsp1 */
/* gpio 4_105-107 = FM/DAC PCM mcbsp2 */
/* gpio 5_128-133 = mmc3 = wifi dsio */
/* gpio 5_134-137 = mmc4 = right SD slot */
			OMAP5_IOPAD(0x1c4, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x1C4:[15:0]  gpio5_144 - reset I2C peripherals */
/* gpio 5_155-156 = mmc4 = right SD slot / uart3 debug */
			OMAP5_IOPAD(0x114, PIN_INPUT | MUX_MODE6)	/* 0x114:[15:0]  gpio6_160 - revision 1 */
			OMAP5_IOPAD(0x12c, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x12C:[15:0]  gpio6_161 - TCA6424 active low interrupt */
/* next 4 should be outputs and controlled by some driver (e.g. regulator-fixed) */
			OMAP5_IOPAD(0x12a, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x128:[31:16]  gpio6_164 - BT EN */
			OMAP5_IOPAD(0x128, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x128:[15:0]  gpio6_165 - Speaker EN */
			OMAP5_IOPAD(0x122, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x120:[31:16]  gpio6_166 - FM EN */

/* gpio 5_167-168 = uart3 Pyra console - should be handled by MLO! */
			OMAP5_IOPAD(0x11c, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x11C:[15:0]  gpio6_169 - Accelerometer interrupt */
			OMAP5_IOPAD(0x11a, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x118:[31:16]  gpio6_170 - Magnetometer interrupt */
			OMAP5_IOPAD(0x118, PIN_OUTPUT_PULLDOWN | MUX_MODE6)	/* 0x118:[15:0]  gpio6_171 - modem ignite */
			OMAP5_IOPAD(0x116, PIN_INPUT | MUX_MODE6)	/* 0x114:[31:16]  gpio6_172 - modem power indication */
			OMAP5_IOPAD(0x114, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x114:[15:0]  gpio6_173 - touch screen penirq */
			OMAP5_IOPAD(0x112, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x110:[31:16]  gpio6_174 - right NUB int */
			OMAP5_IOPAD(0x110, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x110:[15:0]  gpio6_175 - left NUB int */
			OMAP5_IOPAD(0x10c, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x10C:[15:0]  gpio6_177 - keyboard int */
			OMAP5_IOPAD(0x10a, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x108:[31:16]  gpio6_178 - fm int */
			OMAP5_IOPAD(0x130, PIN_INPUT | MUX_MODE6)	/* 0x130:[15:0]  gpio6_182 - revision 2 */
			OMAP5_IOPAD(0x136, PIN_INPUT | MUX_MODE6)	/* 0x134:[31:16]  gpio6_185 - revision 3 */
			OMAP5_IOPAD(0x138, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x138:[15:0]  gpio6_186 - Gyroscope interrupt */
/* gpio 8_228-229 = mmc1 = left SD slot WP/CD */
			OMAP5_IOPAD(0x178, PIN_INPUT_PULLUP | MUX_MODE6)	/* 0x178:[15:0]  gpio8_230 - keypad backlight pwm */
		>;
	};

};

/* register devices connected to Panel-I2C */
&i2c4 {
	/* touchscreen */
	tsc2007@48 {
		compatible = "ti,tsc2007";
		reg = <0x48>;
		pinctrl-names = "default";
/* FIXME:		pinctrl-0 = <&penirq_pins>; */
		interrupt-parent = <&gpio6>;
		interrupts = <13 IRQ_TYPE_EDGE_FALLING>;	/* gpio6_173 falling edge */
		gpios = <&gpio6 13 GPIO_ACTIVE_LOW>;	/* gpio6_173 active low */
/* note: overwrite for rotated screen */
		touchscreen-size-x = <720>;
		touchscreen-size-y = <1280>;
		touchscreen-max-pressure = <1000>;
		touchscreen-fuzz-x = <2>;
		touchscreen-fuzz-y = <5>;
		touchscreen-fuzz-pressure = <50>;
		touchscreen-inverted-y;
		ti,min-x = <140>;
		ti,max-x = <3870>;
		ti,min-y = <50>;
		ti,max-y = <3970>;
		ti,max-rt = <2000>;
		ti,x-plate-ohms = <550>;
	};

	crtouch@49 {
		compatible = "freescale,crtouch";
		reg = <0x49>;
		interrupt-parent = <&gpio6>;
		interrupts = <13 IRQ_TYPE_EDGE_FALLING>;	/* gpio6_173 falling edge */
		gpios = <&gpio6 13 1>;	/* gpio6_173 active low */
		/* more paramters tbd. */
	};

	/* leds */
	is31fl3196@64 {
		compatible = "issi,is31fl3196";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x64>;

		display_led0: red_bottom@0 {
			label = "logo:red:bottom";
			reg = <0>;
			linux,default-trigger = "mmc0";
		};

		display_led1: green_bottom@1 {
			label = "logo:green:bottom";
			reg = <1>;
			linux,default-trigger = "heartbeat";
		};

		display_led2: blue_bottom@2 {
			label = "logo:blue:bottom";
			reg = <2>;
			linux,default-trigger = "timer";
		};

		display_led3: red_top@3 {
			label = "logo:red:top";
			reg = <3>;
			linux,default-trigger = "default-on";
		};

		display_led4: green_top@4 {
			label = "logo:green:top";
			reg = <4>;
			linux,default-trigger = "timer";
		};

		display_led5: blue_top@5 {
			label = "logo:blue:top";
			reg = <5>;
			linux,default-trigger = "mmc0";
		};
	};

	tca6507@45 { /* historical for V4 display boards */
		compatible = "ti,tca6507";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x45>;

		/* unused */
		/* gpio-controller;
		#gpio-cells = <2>; */

		red_aux@0 {
			label = "display::led-0";
			reg = <0x0>;
			linux,default-trigger = "mmc0";
		};

		green_aux@1 {
			label = "display::led-1";
			reg = <0x1>;
			linux,default-trigger = "heartbeat";
		};

		blue_aux@2 {
			label = "display::led-2";
			reg = <0x2>;
			linux,default-trigger = "timer";
		};

		set1@3 {
			label = "display::led-3";
			reg = <0x3>;
			linux,default-trigger = "default-on";
		};

		set2@4 {
			label = "display::led-4";
			reg = <0x4>;
			linux,default-trigger = "timer";
		};

		set3@5 {
			label = "display::led-5";
			reg = <0x5>;
			linux,default-trigger = "mmc0";
		};

		set4@6 {
			label = "display::led-6";
			reg = <0x6>;
			linux,default-trigger = "heartbeat";
		};

	};

};

/* register devices connected to Peripheral-I2C */
&i2c2 {

	/* left nub */
	as5013@40 {
		compatible = "ams,as5013";
		reg = <0x40>;
		// gpios = <&gpio...>, <&gpio>;
		// irq
	};

	/* right nub */
	as5013@41 {
		compatible = "ams,as5013";
		reg = <0x41>;
		// gpios = <&gpio...>, <&gpio>;
		// irq
	};

	/* keyboard scanner */
	tca8418@34 {
		compatible = "ti,tca8418";	/* this translates into request_module("i2c:tca8418")
									   so it must be known as a MODULE_ALIAS to modprobe -c */
		reg = <0x34>;
		/* the interrupt is specified as:
			The first cell is the GPIO number.
			The second cell is used to specify flags:
			bits[3:0] trigger type and level flags:
				1 = low-to-high edge triggered.
				2 = high-to-low edge triggered.
				4 = active high level-sensitive.
				8 = active low level-sensitive.
		 */
		interrupt-parent = <&gpio6>;
		interrupts = <17 IRQ_TYPE_EDGE_RISING>;	/* gpio6_177 low-to-high edge */
		keypad,num-rows = <8>;
		keypad,num-columns = <10>;
		linux,keymap = <
	/* The 32-bit big endian cell is packed as: row << 24 | column << 16 | key-code */

			0x0306003b
			0x0203003c
			0x02040057
			0x01080058
			0x0102003d
			0x0701003e
			0x07030002
			0x06070003
			0x06010004
			0x05050005
			0x06060006
			0x04030007
			0x03070008
			0x03050009
			0x0205000a
			0x0107000b
			0x0702000e
			0x0503000f
			0x06040010
			0x05080011
			0x05020012
			0x04060013
			0x06020014
			0x03040015
			0x02080016
			0x02020017
			0x01060018
			0x00050019
			0x0004001c
			0x0400002a
			0x0506001e
			0x0401001f
			0x04040020
			0x03080021
			0x03020022
			0x02060023
			0x01030024
			0x01040025
			0x00080026
			0x00020036
			0x07060033
			0x06030034
			0x0507002c
			0x0501002d
			0x0405002e
			0x0407002f
			0x03030030
			0x02070031
			0x07040032
			0x01050039
			0x00070039
			0x00000064
			0x01090069
			0x0309006a
			0x00090067
			0x0209006c
			0x05090066
			0x0709006b
			0x04090068
			0x0609006d
			0x03000038
			0x0200001d
			0x01000001
			0x00010036
			0x0101004e
			0x03010061
			0x0201004a
			0x07000110
			0x06000111
		>;
	};

	/* modem current sensor */
	ina231@4f {
		compatible = "ti,ina231";
		reg = <0x4f>;
		shunt-resistor = <20000>;	/* 20 mOhm */
	};

	/* fuel gauge variant 1 */
/* not installed due to bus speed issue
	bq27200@55 {
		compatible = "ti,bq27200";
		status = "disabled";
		reg = <0x55>;
	};
*/

	/* fuel gauge variant 2 */
/* not installed due to bus speed issue
	bq27510@55 {
		compatible = "ti,bq27510";
		reg = <0x55>;
	};
*/

	/* fuel gauge variant 3 */
	bq27621@55 {
		compatible = "ti,bq27621";
		reg = <0x55>;
	};

	/* charger */
	bq24297@6b {
		/* FIXME: driver is quite broken because it is a hack */
		compatible = "ti,bq24297";
		reg = <0x6b>;
		ti,chg_current = <1000 500 2000>;	// chg_current (max for the battery), usb_input_current, adp_input_current
		gpios = <&gpio99 11 0>,		// chg_irq_pin
			<0>;			// dc_det_pin - if 0, charger is switched by driver to 2048mA, otherwise 512mA
	};

};

/* register devices connected to Sensor-I2C */
&i2c3 {
	/* optional gyroscope sensor */
	bmg160@69 {
		compatible = "bosch,bmg160";
		reg = <0x69>;
// irq
	};
	/* optional accelerometer sensor */
	bmc150@10 {
		compatible = "bosch,bma250";
		reg = <0x10>;
/*		pinctrl-names = "default";
		pinctrl-0 = <&bmc150_pins>;
		interrupt-parent = <&gpio6>;
		interrupts = <9 (IRQ_TYPE_LEVEL_HIGH | IRQ_TYPE_EDGE_RISING)>;	/* gpio6_169 * /
*/
	};
	/* optional compass sensor */
	bmc150@12 {
		compatible = "bosch,bmc150";
		reg = <0x12>;
// irq
	};
	/* optional barometer sensor */
	bmp180@77 {
		compatible = "bosch,bmp180";
		reg = <0x77>;
	};
	/* optional barometer/hygrometer sensor */
	bme280@76 {
		// compatible = "bosch,bme280";
		/* ovrwrite to use the bmp280 driver */
		compatible = "bosch,bmp280";
		reg = <0x76>;
	};
	/* optional 9-axis sensor */
	bno050@29 {
		compatible = "bosch,bno050";
		reg = <0x29>;
// irq
	};
};

/* register devices connected to System-I2C */
&i2c5 {
	/* microphone detect */
	ts3a225@3b {
		compatible = "ti,ts3a225";
		reg = <0x3b>;
// irq
	};

	/* system/keyboard-led and other controls */
	gpio99: tca6424@22 {
		compatible = "ti,tca6424";
		interrupt-parent = <&gpio6>;
		interrupts = <1 IRQ_TYPE_LEVEL_LOW>;	/* gpio6_161 */
		reg = <0x22>;
		gpio-controller;
		#gpio-cells = <2>;
		open-drain-pins = <2 3 5 6 7 12 13 17 18 19 21 22 23>;
	};

	is31fl3196@64-left-mid {
		compatible = "issi,is31fl3196";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x64>;

		left_led0: red_left@0 {
			label = "pyra:red:left";
			reg = <0>;
			linux,default-trigger = "mmc0";
		};

		left_led1: green_left@1 {
			label = "pyra:green:left";
			reg = <1>;
			linux,default-trigger = "heartbeat";
		};

		left_led2: blue_left@2 {
			label = "pyra:blue:left";
			reg = <2>;
			linux,default-trigger = "timer";
		};

		mid_led3: red_mid@3 {
			label = "pyra:red:mid";
			reg = <3>;
			linux,default-trigger = "default-on";
		};

		mid_led4: green_mid@4 {
			label = "pyra:green:mid";
			reg = <4>;
			linux,default-trigger = "timer";
		};

		mid_led5: blue_mid@5 {
			label = "pyra:blue:mid";
			reg = <5>;
			linux,default-trigger = "mmc0";
		};
	};

	is31fl3196@67-right {
		compatible = "issi,is31fl3196";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x67>;

		right_led0: red_right@0 {
			label = "pyra:red:right";
			reg = <0>;
			linux,default-trigger = "mmc0";
		};

		right_led1: green_right@1 {
			label = "pyra:green:right";
			reg = <1>;
			linux,default-trigger = "heartbeat";
		};

		right_led2: blue_right@2 {
			label = "pyra:blue:right";
			reg = <2>;
			linux,default-trigger = "timer";
		};
	};

};

/ {
	pyra_leds { /* historical for V4 main boards */
		compatible = "gpio-leds";
		led@1 {
			label = "pyra-old:red:left";
			gpios = <&gpio99 5 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "mmc0";
			default-state = "off";
		};

		led@2 {
			label = "pyra-old:green:left";
			gpios = <&gpio99 6 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@3 {
			label = "pyra-old:blue:left";
			gpios = <&gpio99 7 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@4 {
			label = "pyra-old:red:mid";
			gpios = <&gpio99 17 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "mmc1";
			default-state = "off";
		};

		led@5 {
			label = "pyra-old:green:mid";
			gpios = <&gpio99 18 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@6 {
			label = "pyra-old:blue:mid";
			gpios = <&gpio99 19 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "timer";
			default-state = "off";
		};

		led@7 {
			label = "pyra-old:red:right";
			gpios = <&gpio99 21 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "heartbeat";
			default-state = "off";
		};

		led@8 {
			label = "pyra-old:green:right";
			gpios = <&gpio99 22 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@9 {
			label = "pyra-old:blue:right";
			gpios = <&gpio99 23 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

	};

	keypad_leds { /* historical for V4 main boards */
		compatible = "gpio-leds";

		led@1 {
			label = "keypad1";
			gpios = <&gpio99 2 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@2 {
			label = "keypad2";
			gpios = <&gpio99 3 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@3 {
			label = "keypad3";
			gpios = <&gpio99 12 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};

		led@4 {
			label = "keypad4";
			gpios = <&gpio99 13 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "none";
			default-state = "off";
		};
	};
};

/ {

	pyra-gpio-keys@1 {
		compatible = "gpio-keys";

		#address-cells = <7>;
		#size-cells = <0>;

		left_shoulder_top {
			label = "Left-Shoulder-Top";
			linux,code = <16>;	/* KEY_Q */
			// CHECKME: polarity may change for next revision!
			gpios = <&gpio6 24 GPIO_ACTIVE_LOW>;	/* gpio6_184 */
			gpio-key,wakeup;
		};

		left_shoulder_bottom {
			label = "Left-Shoulder-Bottom";
			linux,code = <44>;	/* KEY_Z */
			gpios = <&gpio6 23 GPIO_ACTIVE_LOW>;	/* gpio6_183 */
			gpio-key,wakeup;
		};

		right_shoulder_top {
			label = "Right-Shoulder-Top";
			linux,code = <25>;	/* KEY_P */
			gpios = <&gpio6 20 GPIO_ACTIVE_LOW>;	/* gpio6_180 */
			gpio-key,wakeup;
		};

		right_shoulder_bottom {
			label = "Right-Shoulder-Bottom";
			linux,code = <50>;	/* KEY_M */
			gpios = <&gpio6 19 GPIO_ACTIVE_LOW>;	/* gpio6_179 */
			gpio-key,wakeup;
		};

		left_nub {
			label = "Left-Nub";
			linux,code = <38>;	/* KEY_L */
			gpios = <&gpio6 27 GPIO_ACTIVE_LOW>;	/* gpio6_187 */
			gpio-key,wakeup;
		};

		right_nub {
			label = "Right-Nub";
			linux,code = <19>;	/* KEY_R */
			gpios = <&gpio6 21 GPIO_ACTIVE_LOW>;	/* gpio6_181 */
			gpio-key,wakeup;
		};

		button_a {
			label = "A";
			linux,code = <30>;	/* KEY_A */
			gpios = <&gpio7 7 GPIO_ACTIVE_LOW>;	/* gpio7_199 */
			gpio-key,wakeup;
		};

		button_b {
			label = "B";
			linux,code = <48>;	/* KEY_B */
			gpios = <&gpio7 4 GPIO_ACTIVE_LOW>;	/* gpio7_196 */
			gpio-key,wakeup;
		};

		button_x {
			label = "X";
			linux,code = <45>;	/* KEY_X */
			gpios = <&gpio7 6 GPIO_ACTIVE_LOW>;	/* gpio7_198 */
			gpio-key,wakeup;
		};

		button_y {
			label = "Y";
			linux,code = <21>;	/* KEY_Y */
			gpios = <&gpio7 5 GPIO_ACTIVE_LOW>;	/* gpio7_197 */
			gpio-key,wakeup;
		};
	};

	pyra-gpio-keys@2 {
		compatible = "gpio-keys";

		#address-cells = <2>;
		#size-cells = <0>;

		wwan_wakeup {
			label = "3G WOE";
			linux,code = <17>;	/* KEY_W */
			gpios = <&gpio1 15 GPIO_ACTIVE_HIGH>;	/* gpio1_wk15 */
			gpio-key,wakeup;
			/* debounce-interval */
		};

		display_lid {
			label = "Display Lid";
			linux,input-type = <5>; /* EV_SW */
			linux,code = <0>; /* SW_LID */
			gpios = <&gpio1 6 GPIO_ACTIVE_LOW>;	/* gpio1_wk6 */
			gpio-key,wakeup;
		};

	};

};

&tpd12s015 {
	compatible = "ti,tpd12s015";
	gpios = <&gpio99 0 GPIO_ACTIVE_HIGH>,	/* TCA6424A P01, CT CP HPD */
		<&gpio99 1 GPIO_ACTIVE_HIGH>,	/* TCA6424A P00, LS OE */
		<&gpio7 1 GPIO_ACTIVE_HIGH>;	/* GPIO 193, HPD */
};

/* more things to do
 * add a regulator-gpio for the LCD
 */

/* used in gpio mode for shoulder buttons etc. */

&mcspi1 {
	status = "disabled";
};

&mcspi2 {
	status = "disabled";
};

/*
 * configure WLAN/Bluetooth module - http://processors.wiki.ti.com/index.php/WL18xx_Platform_Integration_Guide#For_kernels_with_device_tree_support
 * and see http://lxr.free-electrons.com/source/Documentation/devicetree/bindings/net/wireless/ti,wlcore.txt
 */

&wlan_pins {
	status = "okay";
	pinctrl-single,pins = <
		OMAP5_IOPAD(0x126, PIN_OUTPUT | MUX_MODE6)	/* 0x124:[31:16]  gpio6_163 - WLAN EN */
	>;
};

&vmmcsdio_fixed {
	gpio = <&gpio6 3 GPIO_ACTIVE_HIGH>;	/* GPIO6_163 */
	enable-active-high;
};

&mmc3 {
	status = "okay";
/* inherited
	vmmc-supply = <&vmmcsdio_fixed>;
	bus-width = <4>;
	cap-power-off-card;
	non-removable;
	keep-power-in-suspend;
*/

/* find out if we still need this
	bus-width = <4>;
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&mmc3_pins_default &wlan_pins_default>;
	pinctrl-1 = <&mmc3_pins_sleep &wlan_pins_sleep>;
	ti,non-removable;
	ti,needs-special-hs-handling;
	cap-power-off-card;
*/

	#address-cells = <1>;
	#size-cells = <0>;
	wlcore: wlcore@2 {
		compatible = "ti,wl1835";	/* or ti,wl1837" */
		reg = <2>;
		interrupt-parent = <&gpio1>;
		interrupts = <14 IRQ_TYPE_LEVEL_HIGH>;	/* gpio1_wk14 */
		ref-clock-frequency = <26000000>;
	};
};

// uart2-dtr mit gpio6_164 verbinden
// fm-en gpio6_166 mit regulator-fixed der always on ist

/* rearrange to use gpio6_167/168 for console UART3 instead of sdio4_cmd/clk */

&uart3_pins {
	pinctrl-single,pins = <
		OMAP5_IOPAD(0x11e, PIN_OUTPUT | MUX_MODE4) /* uart3_tx_irtx gpio6_168 */
		OMAP5_IOPAD(0x120, PIN_INPUT_PULLUP | MUX_MODE4) /* uart3_rx_irrx gpio6_167 */
	>;
};

&mmc4 { /* now, we can enable the second (µ)SD slot (SDIO capable) */
	status = "okay";
};
